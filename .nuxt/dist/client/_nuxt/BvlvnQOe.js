import{r,m as S,n as A,c as o,a as e,p as m,v as f,F as y,q as g,s as B,u as K,o as s,t as n}from"./B8_WjUqw.js";import{u as x}from"./BMbFKR4x.js";const Y={class:"p-6"},$=["value"],q={class:"mt-8"},C={class:"flex justify-between items-center mb-4"},L={class:"w-full border-collapse bg-white text-left shadow-md rounded-md"},V={class:"p-3"},_={class:"p-3"},M={class:"p-3"},U={class:"p-3"},z=["href"],G={class:"p-3"},O={class:"p-3 text-center"},Q=["onClick"],H={__name:"index",setup(j){const b=r([]),k=r([]),i=r(null),d=r(null),u=r(""),p=r(null),v=r(""),h=a=>{p.value=a.target.files[0]},w=async()=>{const{data:a}=await x("/api/firma/get","$hiKjwOHkh3");b.value=a.value},c=async()=>{const{data:a}=await x("/api/evrak/get","$QBauQSKZII");k.value=a.value},E=async()=>{const a=new FormData;a.append("firmaId",i.value),a.append("kategoriId",d.value),a.append("evrakTuru",u.value),a.append("file",p.value);try{await $fetch("/api/evrak/upload",{method:"POST",body:a}),alert("Dosya başarıyla yüklendi"),c(),D()}catch(t){console.error("Yükleme hatası:",t),alert("Dosya yüklenemedi")}},D=()=>{i.value=null,d.value=null,u.value="",p.value=null;const a=document.getElementById("file");a&&(a.value="")},F=S(()=>k.value.filter(a=>a.firma.firmaAdi.toLowerCase().includes(v.value.toLowerCase()))),T=a=>new Date(a).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric"});A(()=>{w(),c()});const I=async a=>{try{if(!confirm("Bu evrakı silmek istediğinize emin misiniz?"))return;await $fetch(`/api/evrak/delete/${a}`,{method:"DELETE"}),alert("Evrak başarıyla silindi"),c()}catch(t){console.error("Silme hatası:",t),alert("Evrak silinemedi")}};return(a,t)=>(s(),o("div",Y,[t[14]||(t[14]=e("h1",{class:"text-3xl font-bold mb-4"},"Firma Evrak Yükleme",-1)),e("form",{onSubmit:B(E,["prevent"]),class:"space-y-4"},[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700",for:"firmaId"},"Firma:",-1)),m(e("select",{class:"border p-2 rounded w-80","onUpdate:modelValue":t[0]||(t[0]=l=>i.value=l),id:"firmaId",required:""},[(s(!0),o(y,null,g(b.value,l=>(s(),o("option",{key:l.id,value:l.id},n(l.firmaAdi),9,$))),128))],512),[[f,i.value]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700",for:"kategoriId"},"Kategori:",-1)),m(e("select",{class:"border p-2 rounded w-80","onUpdate:modelValue":t[1]||(t[1]=l=>d.value=l),id:"kategoriId",required:""},t[5]||(t[5]=[e("option",{value:"1"},"Firma Evrakları",-1),e("option",{value:"2"},"İSG Evrakları",-1)]),512),[[f,d.value]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700",for:"evrakTuru"},"Evrak Türü",-1)),m(e("select",{class:"border p-2 rounded w-80","onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l),id:"evrakTuru",required:""},t[7]||(t[7]=[e("option",null,"Risk Analizi",-1),e("option",null,"Acil Durum Eylem Planı",-1),e("option",null,"KKD",-1),e("option",null,"Zimmet Formu",-1),e("option",null,"Oryantasyon Formu",-1),e("option",null,"Çalışma Talimatı",-1)]),512),[[f,u.value]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700",for:"file"},"Dosya:",-1)),e("input",{class:"border p-2 rounded w-80",type:"file",id:"file",onChange:h,required:""},null,32)]),t[10]||(t[10]=e("button",{class:"bg-blue-600 text-white px-4 py-2 rounded",type:"submit"},"Yükle",-1))],32),e("div",q,[t[13]||(t[13]=e("h2",{class:"text-2xl font-bold mb-4"},"Yüklenen Evraklar",-1)),e("div",C,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>v.value=l),type:"text",placeholder:"Firma adına göre ara...",class:"border p-2 rounded w-80"},null,512),[[K,v.value]])]),e("table",L,[t[12]||(t[12]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700"},[e("th",{class:"p-3 border-b"},"Firma Adı"),e("th",{class:"p-3 border-b"},"Kategori"),e("th",{class:"p-3 border-b"},"Evrak Türü"),e("th",{class:"p-3 border-b"},"Dosya Adı"),e("th",{class:"p-3 border-b"},"Yüklenme Tarihi"),e("th",{class:"p-3 border-b text-center"},"İşlemler")])],-1)),e("tbody",null,[(s(!0),o(y,null,g(F.value,l=>(s(),o("tr",{key:l.id,class:"border-b hover:bg-gray-100"},[e("td",V,n(l.firma.firmaAdi),1),e("td",_,n(l.kategoriId===1?"Firma Evrakları":"İSG Evrakları"),1),e("td",M,n(l.evrakTuru),1),e("td",U,[e("a",{href:l.dosyaYolu,target:"_blank",class:"text-blue-500 underline"},t[11]||(t[11]=[e("span",{class:"text-lg text-red-700"},"Belgeyi Görüntüle",-1)]),8,z)]),e("td",G,n(T(l.yuklenmeTarihi)),1),e("td",O,[e("button",{onClick:P=>I(l.id),class:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"}," Sil ",8,Q)])]))),128))])])])]))}};export{H as default};
