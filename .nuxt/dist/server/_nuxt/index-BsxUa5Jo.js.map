{"version":3,"file":"index-BsxUa5Jo.js","sources":["../../../../pages/calisanlar/index.vue"],"sourcesContent":["<template>\n  <div class=\"p-4 max-w-full mx-auto bg-white rounded-lg shadow-lg\">\n    <h1 class=\"text-3xl font-semibold mb-6 text-gray-800\">Çalışanlar</h1>\n    \n    <div class=\"mb-4 flex justify-between items-center\">\n  <!-- TC No ile Arama -->\n  <div>\n    <input \n      v-model=\"searchQuery\" \n      type=\"text\" \n      placeholder=\"TC No ile Ara...\" \n      class=\"w-48 p-2 border rounded-lg\"\n    />\n  </div>\n\n  <!-- Durum Filtreleme -->\n  <div>\n    <label for=\"durum\" class=\"block text-sm font-medium text-gray-600 text-center\">Durum</label>\n    <select v-model=\"selectedDurum\" id=\"durum\" class=\"border p-2 w-48 rounded-lg\">\n      <option value=\"\">Tümü</option>\n      <option value=\"true\">Aktif</option>\n      <option value=\"false\">Pasif</option>\n    </select>\n  </div>\n</div>\n\n\n    <!-- Çalışan Tablosu -->\n    <table class=\"w-full border-collapse bg-white text-left shadow-md rounded-md\">\n      <thead>\n        <tr class=\"bg-gray-200 text-gray-700\">\n          <th class=\"p-3 border-b\">Adı</th>\n          <th class=\"p-3 border-b\">Soyadı</th>\n          <th class=\"p-3 border-b\">TC</th>\n          <th class=\"p-3 border-b\">Mesleği</th>\n          <th class=\"p-3 border-b\">İşe Giriş Tarihi</th>\n          <th class=\"p-3 border-b\">İşden Çıkış Tarihi</th>\n          <th class=\"p-3 border-b\">Aktif</th>\n          <th class=\"p-3 border-b\">Firma Adı</th>\n          <th class=\"p-3 border-b\">Taşeron Adı</th>\n          <th class=\"p-3 border-b\">Sağlık Raporu (Gün)</th>\n          <th class=\"p-3 border-b\">Sağlık Raporu URL</th>\n          <th class=\"p-3 border-b\">Sertifika (Gün)</th>\n          <th class=\"p-3 border-b\">Sertifika URL</th>\n          <th class=\"p-3 border-b text-center\">İşlemler</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"calisan in paginatedCalisanlar\" :key=\"calisan.id\" class=\"border-b\">\n          <td class=\"p-3\">{{ calisan.adi }}</td>\n          <td class=\"p-3\">{{ calisan.soyadi }}</td>\n          <td class=\"p-3\">{{ calisan.tc_no }}</td>\n          <td class=\"p-3\">{{ calisan.meslegi }}</td>\n          <td class=\"p-3\">{{ formatDate(calisan.isegiristarihi) }}</td>\n          <td class=\"p-3\">\n          <span class=\"text-green-500\" v-if=\"calisan.isecikistaarihi === null\" >Devam Ediyor</span>\n          <span v-else>{{ formatDate(calisan.isecikistaarihi) }}</span>\n          </td>\n          <td class=\"p-3\">{{ calisan.aktif ? 'Evet' : 'Hayır' }}</td>\n          <td class=\"p-3\">{{ calisan.firma.firmaAdi }}</td>\n          <td class=\"p-3\">\n  <span v-if=\"calisan.yerleske && calisan.yerleske.subeAdi\">{{ calisan.yerleske.subeAdi }}</span>\n  <span v-else>Merkez</span>\n</td>\n          <!-- <td class=\"p-3\">{{ calisan.yerleske.subeAdi }}</td> -->\n          <td class=\"p-3\">\n          <div v-if=\"calisan.saglikRaporlari.length\">\n           <!-- Dizinin son elemanını alıyoruz -->\n          <div>\n         {{ calculateDaysRemaining(calisan.saglikRaporlari[calisan.saglikRaporlari.length - 1].gecerlilikTarihi) }} - gün\n    </div>\n        </div>\n        <div v-else>\n          -\n        </div>\n          </td>\n          <td class=\"p-3\">\n        <div v-if=\"calisan.saglikRaporlari.length\">\n          <div>\n            <a :href=\"calisan.saglikRaporlari[calisan.saglikRaporlari.length -1].raporUrl\" target=\"_blank\">\n              <span class=\"text-lg text-red-700\">Raporu Görüntüle</span></a>\n          </div>\n        </div>\n        <div v-else>\n          Sağlık raporu yok\n        </div>\n          </td>\n          <td class=\"p-3\">\n        <div v-if=\"calisan.sertifikalar.length\">\n          <div>\n            {{ calculateDaysRemaining(calisan.sertifikalar[calisan.sertifikalar.length -1 ].gecerlilikTarihi) }} - gün\n          </div>\n        </div>\n        <div v-else>\n          -\n        </div>\n         </td>\n         <td class=\"p-3\">\n        <div v-if=\"calisan.sertifikalar.length\">\n          <div>\n            <a :href=\"calisan.sertifikalar[calisan.sertifikalar.length -1 ].sertifikaUrl\" target=\"_blank\"><span class=\"text-lg text-blue-500\">Sertikika Görüntüle</span></a>\n          </div>\n        </div>\n        <div v-else>\n          Sertifika yok\n        </div>\n      </td>\n      \n          <td class=\"p-3 text-center\">\n            <!-- Dropdown Menü -->\n            <div class=\"relative\">\n              <button @click=\"toggleDropdown(calisan.id)\" class=\"bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded-lg\">\n                <Icon name=\"mdi-dots-vertical\" class=\"w-5 h-5\" />\n              </button>\n              <div v-if=\"activeDropdown === calisan.id\" class=\"absolute right-0 mt-2 w-40 bg-white border rounded-lg shadow-lg z-50\">\n                <ul class=\"py-1\">\n                  <li>\n                    <button @click=\"editCalisan(calisan)\" class=\"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center\">\n                      <Icon name=\"mdi-pencil\" class=\"w-4 h-4 mr-2\" /> Düzenle\n                    </button>\n                  </li>\n                  <li>\n                    <button @click=\"deleteCalisan(calisan.id)\" class=\"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center\">\n                      <Icon name=\"mdi-delete\" class=\"w-4 h-4 mr-2\" /> Sil\n                    </button>\n                  </li>\n                  <li>\n                      <NuxtLink :to=\"`/calisanlar/dokuman/yukle?calisanId=${calisan.id}&calisanAdi=${calisan.adi}&calisanSoyadi=${calisan.soyadi}`\" class=\"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center\">\n                      <Icon name=\"mdi-book-plus\" class=\"w-4 h-4 mr-2\" />\n                      Belge Yükle\n            </NuxtLink>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n     <!-- Sayfalama -->\n     <div class=\"mt-4 flex justify-between items-center\">\n      <button @click=\"prevPage\" :disabled=\"currentPage === 1\" class=\"bg-gray-500 text-white py-2 px-4 rounded-lg\">Önceki</button>\n      <span>Sayfa {{ currentPage }} / {{ totalPages }}</span>\n      <button @click=\"nextPage\" :disabled=\"currentPage === totalPages\" class=\"bg-gray-500 text-white py-2 px-4 rounded-lg\">Sonraki</button>\n    </div>\n\n\n    \n\n    <!-- Çalışan Ekleme Modal -->\n     <!-- Çalışan Ekleme Modal -->\n<div v-if=\"isCalisanModalOpen\" class=\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\">\n  <div class=\"bg-white p-6 rounded-lg shadow-lg max-w-md w-full\">\n    <h2 class=\"text-2xl mb-4\">Yeni Çalışan Ekle</h2>\n    <form @submit.prevent=\"saveCalisan\">\n      <!-- Adı -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">Adı</label>\n        <input v-model=\"calisanFormFields.adi\" type=\"text\" class=\"border p-2 w-full rounded-md\" required />\n      </div>\n\n      <!-- Soyadı -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">Soyadı</label>\n        <input v-model=\"calisanFormFields.soyadi\" type=\"text\" class=\"border p-2 w-full rounded-md\" required />\n      </div>\n\n      <!-- TC No -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">TC No</label>\n        <input v-model=\"calisanFormFields.tc_no\" type=\"text\" class=\"border p-2 w-full rounded-md\" required maxlength=\"11\" />\n      </div>\n\n      <!-- Mesleği -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">Mesleği</label>\n        <input v-model=\"calisanFormFields.meslegi\" type=\"text\" class=\"border p-2 w-full rounded-md\" required />\n      </div>\n\n      <!-- İşe Giriş Tarihi -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">İşe Giriş Tarihi</label>\n        <input v-model=\"calisanFormFields.isegiristarihi\" type=\"date\" class=\"border p-2 w-full rounded-md\" required />\n      </div>\n\n      <!-- İşten Çıkış Tarihi -->\n      <div class=\"mb-4\">\n        <label class=\"block text-sm font-medium text-gray-600\">İşten Çıkış Tarihi (Opsiyonel)</label>\n        <input v-model=\"calisanFormFields.isecikistaarihi\" type=\"date\" class=\"border p-2 w-full rounded-md\" />\n      </div>\n\n      <!-- Aktif/Pasif Switch -->\n<!-- Aktif/Pasif Switch -->\n<div class=\"mb-4 flex items-center\">\n  <label class=\"block text-sm font-medium text-gray-600 mr-4\">Durum</label>\n  <label class=\"inline-flex relative items-center cursor-pointer\">\n    <input v-model=\"calisanFormFields.aktif\" type=\"checkbox\" class=\"sr-only peer\">\n    <!-- Switch arka planı -->\n    <div class=\"w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-600 peer-focus:ring-4 peer-focus:ring-blue-300 transition-all duration-300\">\n      <!-- Hareket eden nokta -->\n      <div class=\"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5\"></div>\n    </div>\n    <span class=\"ml-3 text-sm font-medium text-gray-900\">{{ calisanFormFields.aktif ? 'Aktif' : 'Pasif' }}</span>\n  </label>\n</div>\n\n      <!-- Kaydet ve Kapat Butonları -->\n      <div class=\"space-y-2\">\n        <button type=\"submit\" class=\"bg-blue-600 text-white py-2 px-4 rounded-md w-full\">Kaydet</button>\n        <button @click=\"closeCalisanModal\" class=\"bg-red-600 text-white py-2 px-4 rounded-md w-full\">Kapat</button>\n      </div>\n    </form>\n  </div>\n</div>\n\n\n\n\n  </div>\n  <div class=\"mt-4\">\n      <NuxtLink to=\"/calisanlar/ekle-excel\" class=\"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md\">\n        Excel ile Ekle\n      </NuxtLink>\n    </div>\n\n    <!-- <table class=\"w-full border-collapse bg-white text-left shadow-md rounded-md\">\n  <thead>\n    <tr class=\"bg-gray-200 text-gray-700\">\n      <th class=\"p-3 border-b\">Adı</th>\n      <th class=\"p-3 border-b\">Soyadı</th>\n      <th class=\"p-3 border-b\">Sağlık Raporu URL</th>\n      <th class=\"p-3 border-b\">Geçerlilik Tarihi</th>\n      <th class=\"p-3 border-b\">Sertifika URL</th>\n      <th class=\"p-3 border-b\">Geçerlilik Tarihi</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr v-for=\"calisan in calisanlar\" :key=\"calisan.id\">\n      <td class=\"p-3\">{{ calisan.adi }}</td>\n      <td class=\"p-3\">{{ calisan.soyadi }}</td>\n      \n      <td class=\"p-3\">\n        <div v-for=\"rapor in calisan.saglikRaporlari\" :key=\"rapor.raporUrl\">\n          <a :href=\"rapor.raporUrl\" target=\"_blank\">{{ rapor.raporUrl }}</a>\n        </div>\n      </td>\n      <td class=\"p-3\">\n        <div v-for=\"rapor in calisan.saglikRaporlari\" :key=\"rapor.raporUrl\">\n          {{ formatDate(rapor.gecerlilikTarihi) }}\n        </div>\n      </td>\n\n      <td class=\"p-3\">\n        <div v-for=\"sertifika in calisan.sertifikalar\" :key=\"sertifika.sertifikaUrl\">\n          <a :href=\"sertifika.sertifikaUrl\" target=\"_blank\">{{ sertifika.sertifikaUrl }}</a>\n        </div>\n      </td>\n      <td class=\"p-3\">\n        <div v-for=\"sertifika in calisan.sertifikalar\" :key=\"sertifika.sertifikaUrl\">\n          {{ formatDate(sertifika.gecerlilikTarihi) }}\n        </div>\n      </td>\n    </tr>\n  </tbody>\n</table> -->\n</template>\n\n<script setup>\n\n\nconst calisanlar = ref([])\nconst searchQuery = ref('')\nconst itemsPerPage = ref(10)\nconst currentPage = ref(1)\nconst isCalisanModalOpen = ref(false)\nconst activeDropdown = ref(null)\nconst selectedDurum = ref('');\nconst calisanFormFields = ref({\n  adi: '',\n  soyadi: '',\n  tc_no: '',\n  meslegi: '',\n  firmaId: 0,\n  firmaYerleskeId: 0,\n  isegiristarihi: '',\n  isecikistaarihi: null,\n  aktif: true,\n})\n\nonMounted( ()=>{\n  fetchCalisanlar();\n  console.log('Sayfa Yüklendi')\n  console.log('DATA',calisanlar)\n  \n})\n\n\n\nconst fetchCalisanlar = async () => {\n  const { data } = await useFetch('/api/calisan/get')\n  calisanlar.value = data.value\n  \n}\n\nconst calculateDaysRemaining = (gecerlilikTarihi) => {\n  const today = new Date();\n  const gecerlilikDate = new Date(gecerlilikTarihi);\n  const diffTime = gecerlilikDate - today;\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); // Milisaniye -> Gün çevirme\n  return diffDays >= 0 ? diffDays : 0; // Eğer süre geçmişse, 0 döner\n}\n\n// Filtrelenmiş çalışan listesi (TC No ile arama)\nconst filteredCalisanlar22 = computed(() => {\n  return calisanlar.value.filter(calisan =>\n    calisan.tc_no.toString().includes(searchQuery.value)\n  )\n})\n\nconst filteredCalisanlar = computed(() => {\n  return calisanlar.value.filter(calisan => {\n    const durumUygun = selectedDurum.value === '' || String(calisan.aktif) === selectedDurum.value;\n    const tcUygun = calisan.tc_no.toString().includes(searchQuery.value);\n    return durumUygun && tcUygun;\n  });\n});\n\n// Toplam sayfa sayısı\nconst totalPages = computed(() => {\n  return Math.ceil(filteredCalisanlar.value.length / itemsPerPage.value)\n})\n\n// Sayfalama ile filtrelenmiş çalışan listesi\nconst paginatedCalisanlar = computed(() => {\n  const start = (currentPage.value - 1) * itemsPerPage.value\n  const end = start + itemsPerPage.value\n  return filteredCalisanlar.value.slice(start, end)\n})\n\n// Sayfaları değiştirme\nconst nextPage = () => {\n  if (currentPage.value < totalPages.value) {\n    currentPage.value++\n  }\n}\n\nconst prevPage = () => {\n  if (currentPage.value > 1) {\n    currentPage.value--\n  }\n}\n\n\n\n\nconst openCalisanModal = () => {\n  isCalisanModalOpen.value = true\n  activeDropdown.value=null\n  \n}\n\nconst closeCalisanModal = () => {\n  isCalisanModalOpen.value = false\n}\n\n// Çalışanı kaydet veya güncelle\n// Çalışanı kaydet (Güncelleme)\nconst saveCalisan = async () => {\n  await useFetch(`/api/calisan/${calisanFormFields.value.id}`, {\n    method: 'PUT',\n    body: calisanFormFields.value,\n  });\n  fetchCalisanlar(); // Güncel listeyi çek\n  closeCalisanModal(); // Modalı kapat\n};\n\n\n\nconst editCalisan = (calisan) => {\n  calisanFormFields.value = { ...calisan,\n    isegiristarihi: formatDateForInput(calisan.isegiristarihi),\n    isecikistaarihi: calisan.isecikistaarihi ? formatDateForInput(calisan.isecikistaarihi) : null,\n   }\n  openCalisanModal()\n}\nconst formatDateForInput = (dateString) => {\n  const date = new Date(dateString);\n  return date.toISOString().split('T')[0]; // YYYY-MM-DD formatında döndür\n};\n\n\nconst deleteCalisan = async (id) => {\n  try {\n    await useFetch(`/api/calisan/${id}`, {\n      method: 'DELETE',\n    });\n    alert('Çalışan başarıyla silindi');\n    fetchCalisanlar(); // Güncel çalışan listesini çek\n  } catch (error) {\n    alert('Çalışan silinirken bir hata oluştu');\n    console.error(error);\n  }\n};\n\nconst addEgitim = (calisanId) => {\n  // Eğitim ekleme işlevi buraya gelecek\n}\n\nconst toggleDropdown = (id) => {\n  activeDropdown.value = activeDropdown.value === id ? null : id\n}\n\n\nconst formatDate = (dateString) => {\nif (!dateString) {\n  return ''\n  \n}\nelse{\n   const date = new Date(dateString);\n  return date.toLocaleDateString('tr-TR', { // 'tr-TR' Türkiye formatı kullanılıyor\n    day: '2-digit',    // Günü 2 basamaklı yapar\n    month: '2-digit',  // Ayı 2 basamaklı yapar\n    year: 'numeric',   // Yılı 4 basamaklı gösterir\n  });\n}\n \n};\n\n</script>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA8QA,UAAM,aAAa,IAAI,EAAE;AACzB,UAAM,cAAc,IAAI,EAAE;AAC1B,UAAM,eAAe,IAAI,EAAE;AAC3B,UAAM,cAAc,IAAI,CAAC;AACzB,UAAM,qBAAqB,IAAI,KAAK;AACpC,UAAM,iBAAiB,IAAI,IAAI;AAC/B,UAAM,gBAAgB,IAAI,EAAE;AAC5B,UAAM,oBAAoB,IAAI;AAAA,MAC5B,KAAK;AAAA,MACL,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,SAAS;AAAA,MACT,SAAS;AAAA,MACT,iBAAiB;AAAA,MACjB,gBAAgB;AAAA,MAChB,iBAAiB;AAAA,MACjB,OAAO;AAAA,IACT,CAAC;AAiBD,UAAM,yBAAyB,CAAC,qBAAqB;AACnD,YAAM,QAAQ,oBAAI;AAClB,YAAM,iBAAiB,IAAI,KAAK,gBAAgB;AAChD,YAAM,WAAW,iBAAiB;AAClC,YAAM,WAAW,KAAK,KAAK,YAAY,MAAO,KAAK,KAAK,GAAG;AAC3D,aAAO,YAAY,IAAI,WAAW;AAAA,IACpC;AAG6B,aAAS,MAAM;AAC1C,aAAO,WAAW,MAAM;AAAA,QAAO,aAC7B,QAAQ,MAAM,SAAQ,EAAG,SAAS,YAAY,KAAK;AAAA,MACrD;AAAA,IACF,CAAC;AAED,UAAM,qBAAqB,SAAS,MAAM;AACxC,aAAO,WAAW,MAAM,OAAO,aAAW;AACxC,cAAM,aAAa,cAAc,UAAU,MAAM,OAAO,QAAQ,KAAK,MAAM,cAAc;AACzF,cAAM,UAAU,QAAQ,MAAM,SAAU,EAAC,SAAS,YAAY,KAAK;AACnE,eAAO,cAAc;AAAA,MACzB,CAAG;AAAA,IACH,CAAC;AAGD,UAAM,aAAa,SAAS,MAAM;AAChC,aAAO,KAAK,KAAK,mBAAmB,MAAM,SAAS,aAAa,KAAK;AAAA,IACvE,CAAC;AAGD,UAAM,sBAAsB,SAAS,MAAM;AACzC,YAAM,SAAS,YAAY,QAAQ,KAAK,aAAa;AACrD,YAAM,MAAM,QAAQ,aAAa;AACjC,aAAO,mBAAmB,MAAM,MAAM,OAAO,GAAG;AAAA,IAClD,CAAC;AA4ED,UAAM,aAAa,CAAC,eAAe;AACnC,UAAI,CAAC,YAAY;AACf,eAAO;AAAA,MAET,OACI;AACD,cAAM,OAAO,IAAI,KAAK,UAAU;AACjC,eAAO,KAAK,mBAAmB,SAAS;AAAA;AAAA,UACtC,KAAK;AAAA;AAAA,UACL,OAAO;AAAA;AAAA,UACP,MAAM;AAAA;AAAA,QACV,CAAG;AAAA,MACH;AAAA,IAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}