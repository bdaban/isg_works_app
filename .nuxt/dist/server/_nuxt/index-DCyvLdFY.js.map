{"version":3,"file":"index-DCyvLdFY.js","sources":["../../../../pages/Belgeler/index.vue"],"sourcesContent":["<template>\n  <div class=\"p-6\">\n    <h1 class=\"text-3xl font-bold mb-4\">Firma Evrak Yükleme</h1>\n\n    <!-- Evrak Yükleme Formu -->\n    <form @submit.prevent=\"uploadFile\" class=\"space-y-4\">\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700\" for=\"firmaId\">Firma:</label>\n        <select class=\"border p-2 rounded w-80\" v-model=\"firmaId\" id=\"firmaId\" required>\n          <option v-for=\"firma in firmalar\" :key=\"firma.id\" :value=\"firma.id\">{{ firma.firmaAdi }}</option>\n        </select>\n      </div>\n\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700\" for=\"kategoriId\">Kategori:</label>\n        <select class=\"border p-2 rounded w-80\" v-model=\"kategoriId\" id=\"kategoriId\" required>\n          <option value=\"1\">Firma Evrakları</option>\n          <option value=\"2\">İSG Evrakları</option>\n        </select>\n      </div>\n\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700\" for=\"evrakTuru\">Evrak Türü</label>\n        <select class=\"border p-2 rounded w-80\" v-model=\"evrakTuru\" id=\"evrakTuru\" required>\n          <option>Risk Analizi</option>\n          <option>Acil Durum Eylem Planı</option>\n          <option>KKD</option>\n          <option>Zimmet Formu</option>\n          <option>Oryantasyon Formu</option>\n          <option>Çalışma Talimatı</option>\n        </select>\n      </div>\n\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700\" for=\"file\">Dosya:</label>\n        <input class=\"border p-2 rounded w-80\" type=\"file\" id=\"file\" @change=\"handleFile\" required />\n      </div>\n\n      <button class=\"bg-blue-600 text-white px-4 py-2 rounded\" type=\"submit\">Yükle</button>\n    </form>\n\n    <!-- Evrak Listesi -->\n    <div class=\"mt-8\">\n      <h2 class=\"text-2xl font-bold mb-4\">Yüklenen Evraklar</h2>\n\n      <!-- Arama ve Filtreleme -->\n      <div class=\"flex justify-between items-center mb-4\">\n        <input\n          v-model=\"searchQuery\"\n          type=\"text\"\n          placeholder=\"Firma adına göre ara...\"\n          class=\"border p-2 rounded w-80\"\n        />\n      </div>\n\n      <table class=\"w-full border-collapse bg-white text-left shadow-md rounded-md\">\n        <thead>\n          <tr class=\"bg-gray-200 text-gray-700\">\n            <th class=\"p-3 border-b\">Firma Adı</th>\n            <th class=\"p-3 border-b\">Kategori</th>\n            <th class=\"p-3 border-b\">Evrak Türü</th>\n            <th class=\"p-3 border-b\">Dosya Adı</th>\n            <th class=\"p-3 border-b\">Yüklenme Tarihi</th>\n            <th class=\"p-3 border-b text-center\">İşlemler</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr\n            v-for=\"evrak in filteredEvraklar\"\n            :key=\"evrak.id\"\n            class=\"border-b hover:bg-gray-100\"\n          >\n            <td class=\"p-3\">{{ evrak.firma.firmaAdi }}</td>\n            <td class=\"p-3\">{{ evrak.kategoriId === 1 ? 'Firma Evrakları' : 'İSG Evrakları' }}</td>\n            <td class=\"p-3\">{{ evrak.evrakTuru }}</td>\n            <td class=\"p-3\">\n              <a :href=\"evrak.dosyaYolu\" target=\"_blank\" class=\"text-blue-500 underline\">\n                <span class=\"text-lg text-red-700\">Belgeyi Görüntüle</span>\n              </a>\n              \n            </td>\n            <td class=\"p-3\">{{ formatDate(evrak.yuklenmeTarihi) }}</td>\n            <td class=\"p-3 text-center\">\n        <button\n          @click=\"deleteEvrak(evrak.id)\"\n          class=\"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\"\n        >\n          Sil\n        </button>\n      </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\n\nconst firmalar = ref([]);\nconst evraklar = ref([]);\nconst firmaId = ref(null);\nconst kategoriId = ref(null);\nconst evrakTuru = ref('');\nconst file = ref(null);\nconst searchQuery = ref('');\n\nconst handleFile = (event) => {\n  file.value = event.target.files[0];\n};\n\nconst fetchFirmalar = async () => {\n  const { data: firmaData } = await useFetch('/api/firma/get');\n  firmalar.value = firmaData.value;\n};\n\nconst fetchEvraklar = async () => {\n  const { data: evrakData } = await useFetch('/api/evrak/get');\n  evraklar.value = evrakData.value;\n};\n\nconst uploadFile = async () => {\n  const formData = new FormData();\n  formData.append('firmaId', firmaId.value);\n  formData.append('kategoriId', kategoriId.value);\n  formData.append('evrakTuru', evrakTuru.value);\n  formData.append('file', file.value);\n\n  try {\n    await $fetch('/api/evrak/upload', {\n      method: 'POST',\n      body: formData,\n    });\n    alert('Dosya başarıyla yüklendi');\n    fetchEvraklar();\n    clearForm();\n   \n    \n  } catch (error) {\n    console.error('Yükleme hatası:', error);\n    alert('Dosya yüklenemedi');\n  }\n};\n// Formu temizleme fonksiyonu\nconst clearForm = () => {\n  firmaId.value = null;\n  kategoriId.value = null;\n  evrakTuru.value = '';\n  file.value = null;\n\n  // Dosya inputunu temizlemek için manuel müdahale\n  const fileInput = document.getElementById('file');\n  if (fileInput) {\n    fileInput.value = '';\n  }\n};\n\n// Evrakları arama ve filtreleme\nconst filteredEvraklar = computed(() => {\n  return evraklar.value.filter((evrak) =>\n    evrak.firma.firmaAdi.toLowerCase().includes(searchQuery.value.toLowerCase())\n  );\n});\n\nconst formatDate = (dateString) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('tr-TR', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n  });\n};\n\nonMounted(() => {\n  fetchFirmalar();\n  fetchEvraklar();\n});\n\nconst deleteEvrak = async (id) => {\n  try {\n    const confirmDelete = confirm('Bu evrakı silmek istediğinize emin misiniz?');\n    if (!confirmDelete) return;\n\n    await $fetch(`/api/evrak/delete/${id}`, {\n      method: 'DELETE',\n    });\n\n    alert('Evrak başarıyla silindi');\n    fetchEvraklar(); // Güncel evrak listesini yeniden yükleyin\n  } catch (error) {\n    console.error('Silme hatası:', error);\n    alert('Evrak silinemedi');\n  }\n};\n</script>\n"],"names":[],"mappings":";;;;;;;AAoGM,UAAA,WAAW,IAAI,CAAA,CAAE;AACjB,UAAA,WAAW,IAAI,CAAA,CAAE;AACP,QAAI,IAAI;AAClB,UAAA,aAAa,IAAI,IAAI;AACrB,UAAA,YAAY,IAAI,EAAE;AACX,QAAI,IAAI;AACf,UAAA,cAAc,IAAI,EAAE;AAqDpB,UAAA,mBAAmB,SAAS,MAAM;AACtC,aAAO,SAAS,MAAM;AAAA,QAAO,CAAC,UAC5B,MAAM,MAAM,SAAS,cAAc,SAAS,YAAY,MAAM,aAAa;AAAA,MAAA;AAAA,IAC7E,CACD;AAEK,UAAA,aAAa,CAAC,eAAe;AAC3B,YAAA,OAAO,IAAI,KAAK,UAAU;AACzB,aAAA,KAAK,mBAAmB,SAAS;AAAA,QACtC,KAAK;AAAA,QACL,OAAO;AAAA,QACP,MAAM;AAAA,MAAA,CACP;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;"}