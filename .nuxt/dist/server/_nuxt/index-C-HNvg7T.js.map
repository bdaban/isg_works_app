{"version":3,"file":"index-C-HNvg7T.js","sources":["../../../../pages/index.vue"],"sourcesContent":["<template>\n  <div class=\"p-6 bg-gray-100 min-h-screen\">\n    <!-- Sayfa Başlığı -->\n    <h1 class=\"text-4xl font-bold text-gray-800 mb-6\">Dashboard</h1>\n\n    <!-- Genel Bilgiler Kartları -->\n    <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\n      <!-- Firma Sayısı Kartı -->\n      <div class=\"bg-white p-4 rounded-lg shadow-md\">\n        <h2 class=\"text-lg font-semibold text-gray-600 mb-2\">Toplam Firma</h2>\n        <p class=\"text-3xl font-bold text-blue-500\">{{ firmaSayisi }}</p>\n      </div>\n\n      <!-- Yerleşke Sayısı Kartı -->\n      <div class=\"bg-white p-4 rounded-lg shadow-md\">\n        <h2 class=\"text-lg font-semibold text-gray-600 mb-2\">Toplam Şube</h2>\n        <p class=\"text-3xl font-bold text-blue-500\">{{ yerleskeSayisi }}</p>\n      </div>\n\n      <!-- Çalışan Sayısı Kartı -->\n      <div class=\"bg-white p-4 rounded-lg shadow-md\">\n        <h2 class=\"text-lg font-semibold text-gray-600 mb-2\">Toplam Çalışan</h2>\n        <p class=\"text-3xl font-bold text-blue-500\">{{ calisanSayisi }}</p>\n      </div>\n    </div>\n    <!-- Firma Filtreleme -->\n    <div class=\"mb-6\">\n      <label for=\"firmaFilter\" class=\"text-lg font-semibold text-gray-600\">Firma Filtrele:</label>\n      <select\n        id=\"firmaFilter\"\n        v-model=\"selectedFirma\"\n        class=\"ml-4 p-2 border border-gray-300 rounded-md\"\n      >\n        <option value=\"\">Tümü</option>\n        <option v-for=\"firma in uniqueFirmalar\" :key=\"firma\" :value=\"firma\">\n          {{ firma }}\n        </option>\n      </select>\n    </div>\n\n    <!-- Sağlık Raporu / Sertifika / Eğitim Geçerlilik Durumu -->\n    \n\n    <!--Testto-->\n    <div class=\"bg-white p-6 rounded-lg shadow-md\">\n      <h2 class=\"text-2xl font-semibold text-gray-700 mb-4\">\n        Sağlık Raporları, Sertifikalar ve Eğitimler\n      </h2>\n      <table class=\"min-w-full bg-white\">\n        <thead>\n          <tr class=\"w-full bg-gray-200 text-gray-600 uppercase text-sm leading-normal\">\n            <th class=\"py-3 px-6 text-left\">Çalışan Adı</th>\n            <th class=\"py-3 px-6 text-left\">Çalışan Firma Adı</th>\n            <th class=\"py-3 px-6 text-left\">Sağlık Raporu Geçerlilik</th>\n            <th class=\"py-3 px-6 text-left\">Sertifika Geçerlilik</th>\n            <th class=\"py-3 px-6 text-left\">Eğitim Geçerlilik</th>\n            <th class=\"py-3 px-6 text-left\">Durum</th>\n          </tr>\n        </thead>\n        <tbody class=\"text-gray-600 text-sm font-light\">\n          <tr\n            v-for=\"calisan in filteredCalisanlar\"\n            :key=\"calisan.id\"\n            class=\"border-b border-gray-200 hover:bg-gray-100\"\n          >\n            <td class=\"py-3 px-6\">\n              {{ calisan.adi }} {{ calisan.soyadi }}\n            </td>\n            <td class=\"py-3 px-6\">{{ calisan.firma.firmaAdi }}</td>\n            <td class=\"py-3 px-6\">\n              <span\n                :class=\"getStatusClass(calisan.saglikRaporuGecerlilik)\"\n              >\n                {{ calisan.saglikRaporuGecerlilik }}\n                <span v-show=\"calisan.saglikRaporuGecerlilik !== 'Yok'\">gün</span>\n              </span>\n            </td>\n            <td class=\"py-3 px-6\">\n              <span\n                :class=\"getStatusClass(calisan.sertifikaGecerlilik)\"\n              >\n                {{ calisan.sertifikaGecerlilik }}\n                <span v-show=\"calisan.sertifikaGecerlilik !== 'Yok'\">gün</span>\n              </span>\n            </td>\n            <td class=\"py-3 px-6\">\n              <span\n                :class=\"getStatusClass(calisan.egitimGecerlilik)\"\n              >\n                {{ calisan.egitimGecerlilik }}\n                <span v-show=\"calisan.egitimGecerlilik !== 'Yok'\">gün</span>\n              </span>\n            </td>\n            <td class=\"py-3 px-6\">\n              <span\n                :class=\"[calisan.aktif ? 'text-green-500' : 'text-red-500']\"\n              >\n                {{ calisan.aktif ? 'Aktif' : 'Pasif' }}\n              </span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\n\nconst firmaSayisi = ref(0);\nconst yerleskeSayisi = ref(0);\nconst calisanSayisi = ref(0);\nconst calisanlar = ref([]);\nconst selectedFirma = ref(\"\"); // Filtreleme için seçilen firma\n\nonMounted(async () => {\n  // Firma, yerleşke, çalışan verilerini çekme\n  const { data: firmaData } = await useFetch('/api/firma/get');\n  const { data: yerleskeData } = await useFetch('/api/yerleske/get');\n  const { data: calisanData } = await useFetch('/api/calisan/get');\n\n  firmaSayisi.value = firmaData.value.length;\n  yerleskeSayisi.value = yerleskeData.value.length;\n  calisanSayisi.value = calisanData.value.length;\n\n\n\n  // Çalışanların sağlık raporu, sertifika ve eğitim geçerlilik sürelerini hesaplama\n  calisanlar.value = await Promise.all(calisanData.value.map(async calisan => {\n    const egitimGecerlilik = await fetchEgitimGecerlilik(calisan.id);\n    return {\n      ...calisan,\n      saglikRaporuGecerlilik: calculateDaysRemaining(calisan.saglikRaporlari),\n      sertifikaGecerlilik: calculateDaysRemaining(calisan.sertifikalar),\n      egitimGecerlilik: egitimGecerlilik,\n    };\n  }));\n});\n\n  // Benzersiz firma adlarını çekmek\n  const uniqueFirmalar = computed(() => {\n  const firmalar = calisanlar.value.map((calisan) => calisan.firma.firmaAdi);\n  return [...new Set(firmalar)];\n});\n\n// Firma adına göre filtrelenmiş çalışanlar\nconst filteredCalisanlar = computed(() => {\n  if (!selectedFirma.value) return calisanlar.value; // Filtre seçilmemişse tüm çalışanları döndür\n  return calisanlar.value.filter(\n    (calisan) => calisan.firma.firmaAdi === selectedFirma.value\n  );\n});\n\n// Çalışanları geçerlilik sürelerine göre azalan şekilde sıralama\nconst sortedCalisanlar = computed(() => {\n  return [...calisanlar.value].sort((a, b) => {\n    const aMin = Math.min(\n      convertToNumber(a.saglikRaporuGecerlilik),\n      convertToNumber(a.sertifikaGecerlilik),\n      convertToNumber(a.egitimGecerlilik)\n    );\n    const bMin = Math.min(\n      convertToNumber(b.saglikRaporuGecerlilik),\n      convertToNumber(b.sertifikaGecerlilik),\n      convertToNumber(b.egitimGecerlilik)\n    );\n    return aMin - bMin; // Azdan çoğa sıralama\n  });\n});\n\n// 'Yok' olan geçerlilik sürelerini sayısal değere dönüştürme\nconst convertToNumber = (value) => {\n  if (value === 'Yok') return Infinity; // 'Yok' varsa sonsuz olarak kabul et\n  return Number(value); // Sayısal değeri döndür\n};\n\nconst fetchEgitimGecerlilik = async (calisanId) => {\n  const { data: egitimData } = await useFetch(`/api/egitim/getByCalisanId?calisanId=${calisanId}`);\n  if (egitimData.value.length === 0) return 'Yok';\n  \n  const today = new Date();\n  const expirationDate = new Date(egitimData.value[0].gecerlilikTarihi); // İlk eğitim kaydını alıyoruz\n  const diffTime = expirationDate - today;\n  return Math.floor(diffTime / (1000 * 60 * 60 * 24)); // Gün olarak döndür\n};\n\nconst calculateDaysRemaining = (documents) => {\n  if (documents.length === 0) return 'Yok';\n  const today = new Date();\n  const expirationDate = new Date(documents[0].gecerlilikTarihi); // İlk belgeyi baz alıyoruz\n  const diffTime = expirationDate - today;\n  return Math.floor(diffTime / (1000 * 60 * 60 * 24)); // Gün olarak döndür\n};\n\nconst getStatusClass = (daysRemaining) => {\n  if (daysRemaining === 'Yok') return 'text-gray-500';\n  return daysRemaining > 30 ? 'text-green-500' : 'text-red-500';\n};\n</script>\n\n<style scoped>\nh1 {\n  color: #333;\n  margin-bottom: 20px;\n  text-align: center;\n}\n</style>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AA8GM,UAAA,cAAc,IAAI,CAAC;AACnB,UAAA,iBAAiB,IAAI,CAAC;AACtB,UAAA,gBAAgB,IAAI,CAAC;AACrB,UAAA,aAAa,IAAI,CAAA,CAAE;AACnB,UAAA,gBAAgB,IAAI,EAAE;AA2BpB,UAAA,iBAAiB,SAAS,MAAM;AAChC,YAAA,WAAW,WAAW,MAAM,IAAI,CAAC,YAAY,QAAQ,MAAM,QAAQ;AACzE,aAAO,CAAC,GAAG,IAAI,IAAI,QAAQ,CAAC;AAAA,IAAA,CAC7B;AAGK,UAAA,qBAAqB,SAAS,MAAM;AACxC,UAAI,CAAC,cAAc,MAAO,QAAO,WAAW;AAC5C,aAAO,WAAW,MAAM;AAAA,QACtB,CAAC,YAAY,QAAQ,MAAM,aAAa,cAAc;AAAA,MAAA;AAAA,IACxD,CACD;AAGwB,aAAS,MAAM;AAC/B,aAAA,CAAC,GAAG,WAAW,KAAK,EAAE,KAAK,CAAC,GAAG,MAAM;AAC1C,cAAM,OAAO,KAAK;AAAA,UAChB,gBAAgB,EAAE,sBAAsB;AAAA,UACxC,gBAAgB,EAAE,mBAAmB;AAAA,UACrC,gBAAgB,EAAE,gBAAgB;AAAA,QAAA;AAEpC,cAAM,OAAO,KAAK;AAAA,UAChB,gBAAgB,EAAE,sBAAsB;AAAA,UACxC,gBAAgB,EAAE,mBAAmB;AAAA,UACrC,gBAAgB,EAAE,gBAAgB;AAAA,QAAA;AAEpC,eAAO,OAAO;AAAA,MAAA,CACf;AAAA,IAAA,CACF;AAGK,UAAA,kBAAkB,CAAC,UAAU;AAC7B,UAAA,UAAU,MAAc,QAAA;AAC5B,aAAO,OAAO,KAAK;AAAA,IAAA;AAqBf,UAAA,iBAAiB,CAAC,kBAAkB;AACpC,UAAA,kBAAkB,MAAc,QAAA;AAC7B,aAAA,gBAAgB,KAAK,mBAAmB;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;"}